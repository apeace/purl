name: Deploy

# Auto-deploy disabled for demo â€” re-enable after 2026-02-27
# on:
#   push:
#     branches: [main]
on: workflow_dispatch

concurrency:
  group: deploy
  cancel-in-progress: false

jobs:
  deploy:
    name: Deploy to production
    runs-on: ubuntu-latest
    steps:
      - name: Deploy via SSH
        uses: appleboy/ssh-action@v1
        with:
          host: ${{ secrets.DEPLOY_HOST }}
          username: ubuntu
          key: ${{ secrets.DEPLOY_SSH_KEY }}
          script: |
            cd /home/ubuntu/purl
            git pull
            docker compose -f deploy/docker-compose.prod.yml up -d --build api nginx process-zendesk-webhooks generate-summaries ollama
            docker image prune -f
            docker volume prune -f
            docker builder prune -f
